webpackJsonp([4],{"/M1Q":function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=n("rVsN"),s=n.n(e),o={data:function(){return{error:"",loading:!0,list:[],isEdit:!1,picked:{},numbers:{},skuModelCache:{},skuModel:null,skuValue:null,skuCartItem:null}},computed:{isAllPicked:function(){var t=this,i=this.isEdit?this.list:this.list.filter(this.isValidGoods);return i.length>0&&i.every(function(i){return!t.isValidGoods(i)||t.picked[i.id]})},totalAmount:function(){var t=this,i=0,n=function(n){if(t.picked[n]){var e=t.list.filter(function(t){return t.id===+n})[0];if(!e)return"continue";i+=e.num*(e.is_comb?e.total_price:e.sale_price)}};for(var e in this.picked){n(e)}return i}},mounted:function(){this.pageInit()},methods:{pageInit:function(){this.fetchCartList()},fetchCartList:function(){var t=this;this.$http.withLoading("/api/goods/carts").then(function(i){t.loading=!1,t.list=i.list,t.$nextTick(function(){t.swiped=window.Swiped.init({query:".cart-item-group .cart-item",list:!0,right:100})})},function(i){t.loading=!1,t.error=i.message})},toggleEdit:function(){var t=this;if(this.isEdit&&(this.list.forEach(function(i){!t.isValidGoods(i)&&t.picked[i.id]&&(t.picked[i.id]=!1)}),this.swiped)){(Array.isArray(this.swiped)?this.swiped:[this.swiped]).forEach(function(t){return t.close()})}this.isEdit=!this.isEdit},togglePickAll:function(t){var i={};if(t){(this.isEdit?this.list:this.list.filter(this.isValidGoods)).forEach(function(t){i[t.id]=!0})}this.picked=i},numberChange:function(t,i){this.modifyCartNum(t,i)},swipeGuard:function(t){this.isEdit||t.stopPropagation()},onRemoveButtonTouch:function(t,i){t.stopPropagation()},remove:function(t){var i=this;this.$messagebox.confirm("确认删除？").then(function(n){"cancel"!==n&&i.$http.withLoading({url:"/api/goods/carts/"+t.id,method:"delete"}).then(function(n){i.$toast("删除成功"),i.list=i.list.filter(function(i){return i!==t})})})},removeAll:function(){var t=this,i=[];for(var n in this.picked)this.picked[n]&&i.push(+n);i.length?this.$messagebox.confirm("确认删除？").then(function(n){"cancel"!==n&&t.$http.withLoading({url:"/api/cart/batches",data:{cart_id:i.map(function(t){return{cart_id:t}})},method:"put"}).then(function(n){t.$toast("删除成功"),t.list=t.list.filter(function(t){return-1===i.indexOf(t.id)})})}):this.$toast("未选中商品")},gotoDetail:function(t){this.$router.push("/product/"+t.goods_id)},showSku:function(t){var i=this;t.is_sku&&(this.skuModelCache[t.goods_id]?this._showSku(t):this.fetchItemSkus(t).then(function(){return i._showSku(t)}))},_showSku:function(t){this.skuModel=this.skuModelCache[t.goods_id],this.skuValue={skuId:t.sku_id,selectedProps:this.$utils.skuTool.getSelectedProps(t.sku_id,this.skuModel.skus),amount:t.num},this.skuCartItem=t},onSkuConfirm:function(){var t=this,i=this.skuCartItem,n=this.skuValue,e=this.skuModel;return n.skuId?n.amount?(this.modifyCartSku(i,n,e).then(function(){t.modifyCartNum(i,n.amount)}),void this.hideSku()):this.$toast("请选择数量"):this.$toast("请选择规格")},modifyCartSku:function(t,i,n){var e=this;return t.sku_id===i.skuId?s.a.resolve({cartItem:t,skuValue:i}):this.$http.withLoading({url:"/api/goods/cart/skus/"+t.id,data:{sku_id:i.skuId},method:"put"}).then(function(s){t.sku_id=i.skuId;var o=e.$utils.skuTool.getSelectedSku(i,n);o&&(t.property=e.$utils.skuTool.getSkuText(o),t.cover=o.image,t.sale_price=o.sale_price,t.stock=o.stock)})},modifyCartNum:function(t,i){this.$http.withLoading({url:"/api/goods/carts/"+t.id,data:{num:i,add_or_less:i-t.num<0?0:1},method:"put"}).then(function(n){t.num=i})},skuVisibleChange:function(t){t||this.hideSku()},hideSku:function(){var t=this;this.skuCartItem=null,this.$nextTick(function(){t.skuModel=null,t.skuValue=null})},fetchItemSkus:function(t){var i=this;return this.$http.withLoading("/api/goodses/"+t.goods_id).then(function(n){var e=n.data;i.goodsInfo=e;var s=e.images.filter(function(t){return t.is_default})[0]||e.images[0];s=s?s.path:"",i.skuModelCache[t.goods_id]={property:e.property,skus:e.skus,goodsInfo:{name:e.name,title:e.goods_title,image:s}}})},gotoPay:function(){var t=this.getPickedIds();if(!t.length)return this.$toast("未选中商品");if(this.getPickedItems().some(function(t){return t.num>t.stock}))return this.$toast("部分商品超出库存");this.$router.push({path:"/cart/order",query:{cart:t.join(",")}})},getPickedItems:function(){var t=this;return this.getPickedIds().map(function(i){return t.list.filter(function(t){return t.id===i})[0]}).filter(function(t){return!!t})},getPickedIds:function(){var t=[];for(var i in this.picked)this.picked[i]&&t.push(+i);return t},isValidGoods:function(t){return 1===t.goods_status}}},a={render:function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{staticClass:"page cart-page"},[t.loading?[t._v("加载中...")]:t.error?[t._v(t._s(t.error))]:t.list.length?[n("x-cell",{staticClass:"fs-me",attrs:{bordered:""}},[n("span",{staticClass:"black-3"},[t._v("全部商品")]),t._v(" "),n("span",{attrs:{slot:"right"},on:{click:t.toggleEdit},slot:"right"},[t._v(t._s(t.isEdit?"完成":"编辑"))])]),t._v(" "),n("div",{staticClass:"cart-item-group swipe-cell-list"},t._l(t.list,function(i){return n("div",{key:i.id,staticClass:"cart-item swipe-cell-item bdb pd",on:{touchstart:t.swipeGuard}},[n("div",{staticClass:"swipe-cell-content"},[t.isEdit||t.isValidGoods(i)?n("x-checkbox",{staticClass:"cart-item-checkbox",model:{value:t.picked[i.id],callback:function(n){t.$set(t.picked,i.id,n)},expression:"picked[item.id]"}}):t._e(),t._v(" "),n("x-media-object",{staticClass:"cart-item-content"},[n("div",{on:{click:function(n){t.isEdit?t.showSku(i):t.gotoDetail(i)}}},[t._v(t._s(i.goods_title))]),t._v(" "),n("div",{staticClass:"image",staticStyle:{width:"2.4rem",height:"2.4rem"},attrs:{slot:"left"},on:{click:function(n){t.isEdit?t.showSku(i):t.gotoDetail(i)}},slot:"left"},[n("img",{attrs:{src:i.cover,alt:"图片"}}),t._v(" "),t.isValidGoods(i)?t._e():n("div",{staticClass:"image-text"},[t._v(t._s(t._f("goodsStatus")(i.goods_status)))])]),t._v(" "),n("span",{attrs:{slot:"secondary"},slot:"secondary"},[t._v(t._s(i.property))]),t._v(" "),n("x-money",{attrs:{slot:"bottom-left",color:"red",value:i.sale_price},slot:"bottom-left"}),t._v(" "),t.isEdit?n("x-number-input",{attrs:{slot:"bottom-right",theme:"light",value:i.num,max:i.stock,disabled:!t.isValidGoods(i)},on:{input:function(n){t.numberChange(i,n)}},slot:"bottom-right"}):n("span",{attrs:{slot:"bottom-right"},slot:"bottom-right"},[t._v("x"+t._s(i.num))])],1)],1),t._v(" "),n("div",{staticClass:"swipe-cell-right",on:{touchstart:function(i){t.onRemoveButtonTouch(i)},click:function(n){t.remove(i)}}},[n("x-button",{staticClass:"cart-item-remove",attrs:{type:"danger"}},[t._v("删除")])],1)])})),t._v(" "),n("x-fixed-bottom",{attrs:{bordered:""}},[n("x-cell",{staticClass:"fs-me",attrs:{slot:"content"},slot:"content"},[n("x-checkbox",{attrs:{value:t.isAllPicked},on:{input:t.togglePickAll}}),t._v(" "),n("span",[t._v("全选")]),t._v(" "),n("div",{attrs:{slot:"right"},slot:"right"},[t._v("合计："),n("x-money",{attrs:{value:t.totalAmount,color:"red"}})],1)],1),t._v(" "),t.isEdit?n("x-button",{staticStyle:{"font-size":"16px"},attrs:{type:"danger"},nativeOn:{click:function(i){t.removeAll(i)}}},[t._v("删   除")]):n("x-button",{staticStyle:{"font-size":"16px"},attrs:{type:"primary"},nativeOn:{click:function(i){t.gotoPay(i)}}},[t._v("去结账")])],1),t._v(" "),n("prod-sku",{attrs:{visible:!!t.skuCartItem,"sku-model":t.skuModel,buttons:["confirm"]},on:{"visible-change":t.skuVisibleChange,confirm:t.onSkuConfirm},model:{value:t.skuValue,callback:function(i){t.skuValue=i},expression:"skuValue"}})]:[n("p",{staticClass:"cart-page-empty"},[n("img",{staticStyle:{"margin-bottom":"10px"},attrs:{src:"/static/icon/img_shopping_cart.png",alt:"没有商品"}}),t._v(" "),n("br"),t._v(" "),n("span",[t._v("购物车空空的哟～您可以")]),t._v(" "),n("br"),n("br"),t._v(" "),n("x-button",{attrs:{type:"primary",inline:"",pill:""},nativeOn:{click:function(i){t.$router.push({path:"/product/list"})}}},[t._v("随便逛逛")])],1)]],2)},staticRenderFns:[]},r=n("/Xao")(o,a,!1,function(t){n("5aMo")},null,null);i.default=r.exports},"5aMo":function(t,i,n){var e=n("yYPl");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);n("8bSs")("14e4e28c",e,!0)},yYPl:function(t,i,n){(t.exports=n("BkJT")(!0)).push([t.i,"\n.cart-page {\n}\n.cart-page .x-icon.x-checkbox {\n  width: 20px;\n  height: 20px;\n}\n.cart-item {\n  position: relative;\n  background-color: #fff;\n}\n.cart-item-content {\n  margin-left: 0.86rem;\n}\n.cart-item .x-button.cart-item-remove {\n  height: 100%;\n  width: 100%;\n}\n.cart-item-checkbox {\n  position: absolute;\n  top: 50%;\n  -webkit-transform: translateY(-50%);\n          transform: translateY(-50%);\n}\n.swipe-cell-list {\n  overflow: hidden;\n}\n.swipe-cell-item {\n  position: relative;\n}\n.swipe-cell-content {\n  width: 100%;\n}\n.swipe-cell-right {\n  position: absolute;\n  left: 100%;\n  top: 0;\n  bottom: 0;\n  width: 100px;\n}\n.cart-page-empty {\n  text-align: center;\n  font-size: 14px;\n  color: #999999;\n  padding-top: 120px;\n}\n.cart-page-empty .x-button {\n  font-size: 16px;\n  padding: 0 0.48rem;\n  height: 0.8rem;\n  line-height: 0.8rem;\n}\n","",{version:3,sources:["E:/dev/wemall/src/views/cart/cart.vue"],names:[],mappings:";AACA;CACC;AACD;EACE,YAAY;EACZ,aAAa;CACd;AACD;EACE,mBAAmB;EACnB,uBAAuB;CACxB;AACD;EACE,qBAAqB;CACtB;AACD;EACE,aAAa;EACb,YAAY;CACb;AACD;EACE,mBAAmB;EACnB,SAAS;EACT,oCAAoC;UAC5B,4BAA4B;CACrC;AACD;EACE,iBAAiB;CAClB;AACD;EACE,mBAAmB;CACpB;AACD;EACE,YAAY;CACb;AACD;EACE,mBAAmB;EACnB,WAAW;EACX,OAAO;EACP,UAAU;EACV,aAAa;CACd;AACD;EACE,mBAAmB;EACnB,gBAAgB;EAChB,eAAe;EACf,mBAAmB;CACpB;AACD;EACE,gBAAgB;EAChB,mBAAmB;EACnB,eAAe;EACf,oBAAoB;CACrB",file:"cart.vue",sourcesContent:["\n.cart-page {\n}\n.cart-page .x-icon.x-checkbox {\n  width: 20px;\n  height: 20px;\n}\n.cart-item {\n  position: relative;\n  background-color: #fff;\n}\n.cart-item-content {\n  margin-left: 0.86rem;\n}\n.cart-item .x-button.cart-item-remove {\n  height: 100%;\n  width: 100%;\n}\n.cart-item-checkbox {\n  position: absolute;\n  top: 50%;\n  -webkit-transform: translateY(-50%);\n          transform: translateY(-50%);\n}\n.swipe-cell-list {\n  overflow: hidden;\n}\n.swipe-cell-item {\n  position: relative;\n}\n.swipe-cell-content {\n  width: 100%;\n}\n.swipe-cell-right {\n  position: absolute;\n  left: 100%;\n  top: 0;\n  bottom: 0;\n  width: 100px;\n}\n.cart-page-empty {\n  text-align: center;\n  font-size: 14px;\n  color: #999999;\n  padding-top: 120px;\n}\n.cart-page-empty .x-button {\n  font-size: 16px;\n  padding: 0 0.48rem;\n  height: 0.8rem;\n  line-height: 0.8rem;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=4.95917a5f33b387f79097.js.map