{"version":3,"sources":["webpack:///src/views/order/refund-form.vue","webpack:///./src/views/order/refund-form.vue?e605","webpack:///./src/views/order/refund-form.vue"],"names":["refund_form","goodsid","undefined","key","options","fetchRefundData","fetchRefundResons","_this","this","goodsId","then","res","_this2","list","_this3","validateForm","msg","refundType","refundReason","hasReceived","refund_amount","data","order_refund_form","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","title","label","value","secondary","model","callback","$$v","expression","_v","reasonOptions","refundAmount","placeholder","attr","maxlength","remark","limit","type","size","nativeOn","click","$event","submit","_e","staticRenderFns","Component","__webpack_require__","normalizeComponent","__webpack_exports__"],"mappings":"wGAoDA,IAAAA,gEAKA,gCACAC,mBACA,eACA,cACA,oBACAC,SACA,2JAUAC,WAEAC,4BAIAC,uBACAC,yDAGA,IAAAC,EAAAC,+DACAC,SAAAC,KAAA,SAAAC,iDAGA,IAAAC,EAAAJ,4EAEAK,0BAGA,IAAAC,EAAAN,YACAO,uCAEAC,oBAEAC,+BACAR,uBACAS,+BACAC,mCAEAjB,GANA,IAAAM,KAAAS,YAAAT,KAAAW,wCASAC,oDAEA,oHAOA,0BACAC,SACA,SAHAX,KAAA,SAAAC,YAKA,mCAEAF,0IASA,GAFA,UAFA,cCpHAa,GADiBC,OARjB,WAA0B,IAAAC,EAAAhB,KAAaiB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,0BAAoCL,EAAA,MAAAG,EAAA,kBAAmCE,YAAA,MAAAC,OAAyBC,MAAA,OAAA3B,UACjM4B,MAAA,OAAAC,MAAA,EAAAC,UAAA,SACAF,MAAA,OAAAC,MAAA,KACDE,OAAQF,MAAAT,EAAA,WAAAY,SAAA,SAAAC,GAAgDb,EAAAP,WAAAoB,GAAmBC,WAAA,gBAA0Bd,EAAAe,GAAA,KAAAZ,EAAA,kBAAmCE,YAAA,MAAAC,OAAyBC,MAAA,OAAA3B,UAChK4B,MAAA,OAAAC,MAAA,IACAD,MAAA,OAAAC,MAAA,KACDE,OAAQF,MAAAT,EAAA,YAAAY,SAAA,SAAAC,GAAiDb,EAAAL,YAAAkB,GAAoBC,WAAA,iBAA2Bd,EAAAe,GAAA,KAAAZ,EAAA,YAA6BE,YAAA,MAAAC,OAAyBC,MAAA,OAAA3B,QAAAoB,EAAAgB,eAA2CL,OAAQF,MAAAT,EAAA,aAAAY,SAAA,SAAAC,GAAkDb,EAAAN,aAAAmB,GAAqBC,WAAA,kBAA4Bd,EAAAe,GAAA,KAAAZ,EAAA,WAA4BE,YAAA,MAAAC,OAAyBE,MAAA,QAAeG,OAAQF,MAAAT,EAAA,aAAAY,SAAA,SAAAC,GAAkDb,EAAAiB,aAAAJ,GAAqBC,WAAA,kBAA4Bd,EAAAe,GAAA,KAAAZ,EAAA,WAA4BE,YAAA,MAAAC,OAAyBE,MAAA,OAAAU,YAAA,KAAAC,MAA0CC,UAAA,MAAkBT,OAAQF,MAAAT,EAAA,OAAAY,SAAA,SAAAC,GAA4Cb,EAAAqB,OAAAR,GAAeC,WAAA,YAAsBd,EAAAe,GAAA,KAAAZ,EAAA,UAAAA,EAAA,OAAqCE,YAAA,QAAkBL,EAAAe,GAAA,WAAAf,EAAAe,GAAA,KAAAZ,EAAA,kBAAqDG,OAAOgB,MAAA,MAAW,GAAAtB,EAAAe,GAAA,KAAAZ,EAAA,kBAAAA,EAAA,YAAsDG,OAAOiB,KAAA,UAAAC,KAAA,QAA+BC,UAAWC,MAAA,SAAAC,GAAyB3B,EAAA4B,OAAAD,OAAqB3B,EAAAe,GAAA,aAAAf,EAAA6B,MAAA,IAEv7BC,oBCKjBC,EAbAC,EAAA,OAaAC,CACAzD,EACAsB,GATA,EAEA,KAEA,KAEA,MAUAoC,EAAA,QAAAH,EAAA","file":"static/js/25.c5207affde89150eb204.js","sourcesContent":["<template>\n  <div class=\"page refund-form-page\">\n    <template v-if=\"data\">\n      <!--<div class=\"goods-list\">-->\n        <!--<x-media-object-->\n          <!--v-for=\"goods in data.goods\"-->\n          <!--:key=\"goods.goods_id\"-->\n          <!--class=\"mgb\"-->\n          <!--:pic=\"goods.goods_cover\"-->\n          <!--padding>-->\n          <!--<div>{{ goods.goods_name }}</div>-->\n          <!--<span slot=\"secondary\">{{ goods.sku_name.join(' ') }}</span>-->\n          <!--<x-money :value=\"goods.sale_price\" size=\"small\" slot=\"bottom-left\"></x-money>-->\n        <!--</x-media-object>-->\n      <!--</div>-->\n      <x-radio-select\n        class=\"mgb\"\n        title=\"退款类型\"\n        v-model=\"refundType\"\n        :options=\"[\n          { label: '我要退款', value: 1, secondary: '无需退货' },\n          { label: '我要退货', value: 2 }\n        ]\">\n      </x-radio-select>\n      <x-radio-select\n        class=\"mgb\"\n        title=\"收货状态\"\n        v-model=\"hasReceived\"\n        :options=\"[\n          { label: '未收到货', value: 0 },\n          { label: '已收到货', value: 1 }\n        ]\">\n      </x-radio-select>\n      <x-select\n        class=\"mgb\"\n        title=\"退款原因\"\n        v-model=\"refundReason\"\n        :options=\"reasonOptions\">\n      </x-select>\n      <x-field class=\"mgb\" label=\"退款金额\" v-model=\"refundAmount\"></x-field>\n      <x-field class=\"mgb\" label=\"退款备注\" placeholder=\"选填\" v-model=\"remark\" :attr=\"{ maxlength: 100 }\"></x-field>\n      <x-cell>\n        <div class=\"mgb\">上传凭证：</div>\n        <x-image-upload :limit=\"3\"></x-image-upload>\n      </x-cell>\n      <x-fixed-bottom>\n        <x-button type=\"primary\" @click.native=\"submit\" size=\"full\">提交</x-button>\n      </x-fixed-bottom>\n    </template>\n  </div>\n</template>\n<script>\n  export default {\n    data: function () {\n      return {\n        pageType: +this.$route.query.type, // 1仅退款 2退货退款\n        data: null,\n        goodsId: +this.$route.query.goodsid,\n        refundType: 1,\n        refundReason: 0,\n        hasReceived: 0,\n        refundAmount: undefined,\n        remark: '',\n        images: [],\n        allReasons: [] // 退款原因，服务端返回\n      }\n    },\n    computed: {\n      reasonOptions () {\n        const options = []\n        const obj = this.allReasons[this.refundType - 1] || {}\n        for (let key in obj) {\n          options.push({ label: obj[key], value: +key })\n        }\n        return options\n      }\n    },\n    mounted () {\n      this.fetchRefundData()\n      this.fetchRefundResons()\n    },\n    methods: {\n      fetchRefundData () {\n        this.$http.withLoading(`/api/order/refund/confirms/${this.goodsId}`)\n          .then(res => { this.data = res.data })\n      },\n      fetchRefundResons () {\n        this.$http('/api/order/refund/reason').then(res => {\n          this.allReasons = res.list\n        })\n      },\n      submit () {\n        const msg = this.validateForm()\n        if (msg) return this.$toast(msg)\n\n        const data = {\n          type: this.refundType,\n          order_goods_id: this.goodsId,\n          reason_id: this.refundReason,\n          is_receiving: this.hasReceived,\n          desc: this.remark || undefined\n        }\n        // 退款金额\n        if (this.refundType === 2 || this.hasReceived) {\n          data.required_amount = this.data.refund_amount\n        } else if (this.refundAmount) {\n          data.required_amount = this.refundAmount * 100\n        }\n        // TODO 上传图片\n\n        this.$messagebox.confirm('确认提交申请吗？').then(action => {\n          if (action === 'cancel') return\n          this.$http.withLoading({\n            url: '/api/order/refunds',\n            data: data,\n            method: 'post'\n          }).then(res => {\n            this.$toast('提交成功')\n            // FIXME why location\n            location.href = '/refund/' + this.goodsId\n          })\n        })\n      },\n      validateForm () {\n        if (!this.refundReason) return '退款原因不能为空'\n        if (this.refundType === 1 && !this.hasReceived && this.pageType === 2 && !this.refundAmount) {\n          return '请输入退款金额'\n        }\n        return ''\n      }\n    }\n  }\n</script>\n\n\n\n// WEBPACK FOOTER //\n// src/views/order/refund-form.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page refund-form-page\"},[(_vm.data)?[_c('x-radio-select',{staticClass:\"mgb\",attrs:{\"title\":\"退款类型\",\"options\":[\n        { label: '我要退款', value: 1, secondary: '无需退货' },\n        { label: '我要退货', value: 2 }\n      ]},model:{value:(_vm.refundType),callback:function ($$v) {_vm.refundType=$$v},expression:\"refundType\"}}),_vm._v(\" \"),_c('x-radio-select',{staticClass:\"mgb\",attrs:{\"title\":\"收货状态\",\"options\":[\n        { label: '未收到货', value: 0 },\n        { label: '已收到货', value: 1 }\n      ]},model:{value:(_vm.hasReceived),callback:function ($$v) {_vm.hasReceived=$$v},expression:\"hasReceived\"}}),_vm._v(\" \"),_c('x-select',{staticClass:\"mgb\",attrs:{\"title\":\"退款原因\",\"options\":_vm.reasonOptions},model:{value:(_vm.refundReason),callback:function ($$v) {_vm.refundReason=$$v},expression:\"refundReason\"}}),_vm._v(\" \"),_c('x-field',{staticClass:\"mgb\",attrs:{\"label\":\"退款金额\"},model:{value:(_vm.refundAmount),callback:function ($$v) {_vm.refundAmount=$$v},expression:\"refundAmount\"}}),_vm._v(\" \"),_c('x-field',{staticClass:\"mgb\",attrs:{\"label\":\"退款备注\",\"placeholder\":\"选填\",\"attr\":{ maxlength: 100 }},model:{value:(_vm.remark),callback:function ($$v) {_vm.remark=$$v},expression:\"remark\"}}),_vm._v(\" \"),_c('x-cell',[_c('div',{staticClass:\"mgb\"},[_vm._v(\"上传凭证：\")]),_vm._v(\" \"),_c('x-image-upload',{attrs:{\"limit\":3}})],1),_vm._v(\" \"),_c('x-fixed-bottom',[_c('x-button',{attrs:{\"type\":\"primary\",\"size\":\"full\"},nativeOn:{\"click\":function($event){_vm.submit($event)}}},[_vm._v(\"提交\")])],1)]:_vm._e()],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.5.0@vue-loader/lib/template-compiler?{\"id\":\"data-v-0ec99afb\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.5.0@vue-loader/lib/selector.js?type=template&index=0!./src/views/order/refund-form.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../node_modules/_vue-loader@13.5.0@vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vue-loader@13.5.0@vue-loader/lib/selector?type=script&index=0!./refund-form.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_vue-loader@13.5.0@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0ec99afb\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vue-loader@13.5.0@vue-loader/lib/selector?type=template&index=0!./refund-form.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/order/refund-form.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}