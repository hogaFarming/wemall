webpackJsonp([12],{"3SKG":function(t,o,s){var n=s("hpDY");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);s("8bSs")("1b83a98e",n,!0)},KZiI:function(t,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=s("4YfN"),i=s.n(n),e={data:function(){return{id:this.$route.params.id,swipeImgs:[],goodsInfo:{},skuButtons:["cart","buy"],skuVisible:!1,skuModel:null,skuValue:null,comboVisible:!1,combos:[],selectedCombo:"xxx-1",comments:[],commentsTotal:10,commentsGoodPercent:"",cartCount:0,recommends:[],likePending:!1}},computed:{selectedSku:function(){return this.goodsInfo.id?this.goodsInfo.is_sku?this.$utils.skuTool.getSelectedSku(this.skuValue,this.skuModel)||{}:this.goodsInfo.skus[0]||{}:{}},selectedSkuText:function(){return this.$utils.skuTool.getSkuText(this.selectedSku)}},mounted:function(){this.pageInit()},methods:{pageInit:function(){this.fetchDetails().then(this.fetchRecommends),this.fetchCombos(),this.fetchComments(),this.fetchCommentReport(),this.fetchCartNumbers()},fetchDetails:function(){var t=this;return this.$http.withLoading("/api/goodses/"+this.id).then(function(o){var s=o.data;t.goodsInfo=s,t.initSlider(s.images),s.is_sku&&t.initSkuData(s)},function(o){t.error=o.message})},fetchCombos:function(){var t=this,o={goods_id:this.id};this.$http("/api/goods/combs",{params:o}).then(function(o){t.combos=o.list.map(function(o,s){return i()({},o,{show_name:"套装"+t.$utils.getChinaNum(s+1)})})},function(o){t.$toast(o.message)})},fetchComments:function(){var t=this,o={goods_id:this.id};this.$http("/api/goods/comments",{params:o}).then(function(o){t.comments=o.list.data.map(function(t){var o=[];for(var s in t.sku_name_arr)o.push(t.sku_name_arr[s]);return i()({},t,{sku_show_name:o.join("  ")})}),t.commentsTotal=o.list.total})},fetchCommentReport:function(){var t=this,o={goods_id:this.id};this.$http("/api/comments/data",{params:o}).then(function(o){o.data.count?t.commentsGoodPercent=o.data.good_colmment/o.data.count:t.commentsGoodPercent=""})},fetchCartNumbers:function(){var t=this;this.$http("/api/cart/nums").then(function(o){t.cartCount=o.data.shopcart_count})},fetchRecommends:function(){var t=this,o=this.goodsInfo.goods_cat_id_third||this.goodsInfo.goods_cat_id_second||this.goodsInfo.goods_cat_id_first;if(o){var s={goods_cat_id:o};this.$http("/api/goods/guesses",{params:s}).then(function(o){t.recommends=o.list})}else console.error("获取分类id失败")},initSlider:function(t){var o="";for(var s in t)t[s].is_default?o=t[s].path:this.swipeImgs.push(t[s].path);o&&this.swipeImgs.unshift(o)},initSkuData:function(t){this.skuModel={property:t.property,skus:t.skus,goodsInfo:{name:t.name,title:t.goods_title,image:this.getGoodsDefaultImage(t)}};var o=this.$route.query.sku_id;o&&(this.skuValue={skuId:o,amount:1,selectedProps:this.$utils.skuTool.getSelectedProps(o,t.skus)})},getGoodsDefaultImage:function(t){var o=t.images.filter(function(t){return t.is_default})[0]||t.images[0];return o?o.path:""},likeGoods:function(){var t=this;if(!this.likePending){this.likePending=!0;var o={goods_id:this.id};this.$http.post("/api/goods/collects",o).then(function(o){t.likePending=!1,t.goodsInfo.is_collect=1,t.$toast("收藏成功")},function(o){t.likePending=!1,t.$toast(o.message)})}},shareGoods:function(){},addCart:function(){var t=this,o=this.selectedSku.id,s=this.goodsInfo.is_sku?this.skuValue&&this.skuValue.amount:1;return o?0===this.selectedSku.stock?this.$toast("库存不足"):s?void this.$http.withLoading({url:"/api/goods/carts",method:"post",data:{goods_id:this.id,num:s,sku_id:o}}).then(function(o){t.$toast("成功加入购物车"),t.$nextTick(function(){t.cartCount+=1,t.skuVisible=!1})}):this.$toast({message:"请选择商品数量"}):this.$toast("请选择规格")},gotoCart:function(){this.$router.push({path:"/cart"})},buyNow:function(){0===this.goodsInfo.is_sku?this.$router.push({path:"/cart/order",query:{goods_id:this.query.goods_id,sku_id:this.goodsInfo.skus[0].id,num:1}}):this.showSku(!0)},confirmBuyNow:function(){var t=this.selectedSku;return t.id?t.stock<=0?this.$toast("库存不足"):void this.$router.push({path:"/cart/order",query:{goods_id:this.id,sku_id:this.skuValue.skuId,num:this.skuValue.amount}}):this.$toast("请选择规格")},showProdCombo:function(){this.comboVisible=!0},showSku:function(t){this.skuButtons=!0===t?["confirm"]:["buy","cart"],this.skuVisible=!0},skuVisibleChange:function(t){this.skuVisible=t},skuValueChange:function(t){this.skuValue=t,console.log(t)}}},a={render:function(){var t=this,o=t.$createElement,s=t._self._c||o;return s("div",{staticClass:"page-product-detail"},[s("div",{staticClass:"top-slider-wrap bdb"},[s("x-slider",{staticClass:"bdb",attrs:{indicator:"number",length:t.swipeImgs.length}},t._l(t.swipeImgs,function(o){return s("x-slider-item",{key:o,nativeOn:{click:function(s){t.seeImg(o,t.swipeImgs)}}},[s("img",{attrs:{src:o,alt:""}})])})),t._v(" "),0===t.goodsInfo.is_collect?s("x-icon",{staticClass:"product-like-icon",attrs:{type:"praise"},nativeOn:{click:function(o){t.likeGoods(o)}}}):t._e(),t._v(" "),s("x-icon",{staticClass:"product-share-icon",attrs:{type:"share"},nativeOn:{click:function(o){t.shareGoods(o)}}})],1),t._v(" "),s("div",{staticClass:"mod_pd mgb prod-info"},[s("p",{staticClass:"title black-2 fs-lg"},[t._v(t._s(t.goodsInfo.goods_title))]),t._v(" "),t.selectedSku.sale_price?s("x-money",{staticClass:"price",attrs:{value:t.selectedSku.sale_price,size:"large"}}):t._e()],1),t._v(" "),s("div",{staticClass:"mgb"},[s("x-cell",{attrs:{"icon-right":"more",bordered:""},nativeOn:{click:function(o){t.showProdCombo(o)}}},[s("span",{staticClass:"black-3",staticStyle:{"margin-right":"1.2em"}},[t._v("促销")]),t._v(" "),s("span",{staticClass:"red"},[t._v("优惠套装")]),t._v(" "),s("span",[t._v("| 最高省200.00元")])]),t._v(" "),t.goodsInfo.is_sku?s("x-cell",{attrs:{"icon-right":"more"},nativeOn:{click:function(o){t.showSku()}}},[s("span",{staticClass:"black-3"},[t._v("已选规格：")]),t._v(" "),s("span",[t._v(t._s(t.selectedSkuText))])]):t._e()],1),t._v(" "),t.comments.length?s("comment-short-list",{attrs:{comments:t.comments,total:t.commentsTotal,"good-percent":t.commentsGoodPercent,"goods-id":t.id}}):t._e(),t._v(" "),s("prod-recommend",{attrs:{items:t.recommends}}),t._v(" "),s("long-detail",{attrs:{content:t.goodsInfo.desc}}),t._v(" "),s("x-fixed-bottom",{staticClass:"product-detail-bottom"},[s("div",{staticClass:"gocart-button",class:{"has-goods":t.cartCount>0},on:{click:t.gotoCart}},[s("div",{staticClass:"gocart-button-inner"},[s("x-icon",{attrs:{type:"cart"}}),t._v(" "),s("br"),t._v(" "),s("span",[t._v("购物车")]),t._v(" "),s("i",{staticClass:"gocart-button-redpoint"})],1)]),t._v(" "),s("x-button",{attrs:{type:"primary"},nativeOn:{click:function(o){t.addCart(o)}}},[t._v("加入购物车")]),t._v(" "),s("x-button",{attrs:{type:"danger"},nativeOn:{click:function(o){t.buyNow(o)}}},[t._v("立即购买")])],1),t._v(" "),s("prod-sku",{attrs:{visible:t.skuVisible,value:t.skuValue,"sku-model":t.skuModel,buttons:t.skuButtons},on:{"visible-change":t.skuVisibleChange,input:t.skuValueChange,cart:t.addCart,buy:t.buyNow,confirm:t.confirmBuyNow}}),t._v(" "),s("prod-combo",{attrs:{visible:t.comboVisible,options:t.combos,value:t.selectedCombo},on:{"visible-change":function(o){t.comboVisible=o},input:function(o){t.selectedCombo=o}}})],1)},staticRenderFns:[]},r=s("/Xao")(e,a,!1,function(t){s("3SKG")},null,null);o.default=r.exports},hpDY:function(t,o,s){(t.exports=s("BkJT")(!0)).push([t.i,"\n.top-slider-wrap {\n  position: relative;\n}\n.top-slider-wrap .x-slider-item img {\n  height: 8.4rem;\n}\n.product-like-icon.x-icon,\n.product-share-icon.x-icon {\n  position: absolute;\n  top: 0.4237rem;\n  width: 26px;\n  height: 26px;\n}\n.product-like-icon {\n  left: 0.48rem;\n}\n.product-share-icon {\n  right: 0.48rem;\n}\n.gocart-button {\n  position: relative;\n  text-align: center;\n  font-size: 12px;\n  width: 2rem;\n  background: #fff;\n  border-top: 1px solid #e8e8e8;\n}\n.gocart-button-inner {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.gocart-button-redpoint {\n  display: none;\n  position: absolute;\n  right: 5px;\n  top: -2px;\n  background-color: red;\n  width: 6px;\n  height: 6px;\n  border-radius: 100%;\n}\n.gocart-button.has-goods .gocart-button-redpoint {\n  display: block;\n}\n.product-detail-bottom {\n  -webkit-box-align: stretch;\n      -ms-flex-align: stretch;\n          align-items: stretch;\n}\n.product-detail-bottom > * {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n","",{version:3,sources:["E:/dev/wemall/src/views/product/detail.vue"],names:[],mappings:";AACA;EACE,mBAAmB;CACpB;AACD;EACE,eAAe;CAChB;AACD;;EAEE,mBAAmB;EACnB,eAAe;EACf,YAAY;EACZ,aAAa;CACd;AACD;EACE,cAAc;CACf;AACD;EACE,eAAe;CAChB;AACD;EACE,mBAAmB;EACnB,mBAAmB;EACnB,gBAAgB;EAChB,YAAY;EACZ,iBAAiB;EACjB,8BAA8B;CAC/B;AACD;EACE,mBAAmB;EACnB,UAAU;EACV,SAAS;EACT,yCAAyC;UACjC,iCAAiC;CAC1C;AACD;EACE,cAAc;EACd,mBAAmB;EACnB,WAAW;EACX,UAAU;EACV,sBAAsB;EACtB,WAAW;EACX,YAAY;EACZ,oBAAoB;CACrB;AACD;EACE,eAAe;CAChB;AACD;EACE,2BAA2B;MACvB,wBAAwB;UACpB,qBAAqB;CAC9B;AACD;EACE,oBAAoB;MAChB,YAAY;UACR,QAAQ;CACjB",file:"detail.vue",sourcesContent:["\n.top-slider-wrap {\n  position: relative;\n}\n.top-slider-wrap .x-slider-item img {\n  height: 8.4rem;\n}\n.product-like-icon.x-icon,\n.product-share-icon.x-icon {\n  position: absolute;\n  top: 0.4237rem;\n  width: 26px;\n  height: 26px;\n}\n.product-like-icon {\n  left: 0.48rem;\n}\n.product-share-icon {\n  right: 0.48rem;\n}\n.gocart-button {\n  position: relative;\n  text-align: center;\n  font-size: 12px;\n  width: 2rem;\n  background: #fff;\n  border-top: 1px solid #e8e8e8;\n}\n.gocart-button-inner {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.gocart-button-redpoint {\n  display: none;\n  position: absolute;\n  right: 5px;\n  top: -2px;\n  background-color: red;\n  width: 6px;\n  height: 6px;\n  border-radius: 100%;\n}\n.gocart-button.has-goods .gocart-button-redpoint {\n  display: block;\n}\n.product-detail-bottom {\n  -webkit-box-align: stretch;\n      -ms-flex-align: stretch;\n          align-items: stretch;\n}\n.product-detail-bottom > * {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n}\n"],sourceRoot:""}])}});
//# sourceMappingURL=12.13ee7efc325fde6fa59d.js.map